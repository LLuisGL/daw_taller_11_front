<!doctype html>
<html lang="en">
    <head>
        <!-- Required meta tags -->
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
        <link rel='stylesheet' href='../css/styles.css' />
        <title><%= title%></title>
    </head>
    <body class="bg-light d-flex flex-column min-vh-100">
        <%- include("partials/navbar") -%>
        <main class="flex-grow-1">
        <div class="container-fluid py-4">
            <div class="row g-4">
                <!-- Left Column: Forms -->
                <div class="col-lg-6">
                    <!-- Form Toggle Buttons -->
                    <div class="card shadow-sm border-0 mb-4">
                        <div class="card-body p-3">
                            <div class="btn-group w-100" role="group" aria-label="Form toggle">
                                <input type="radio" class="btn-check" name="formToggle" id="formAdd" autocomplete="off" checked>
                                <label class="btn btn-outline-primary btn-lg w-50" for="formAdd">
                                    <i class="bi bi-plus-circle me-2"></i>Add Photo
                                </label>

                                <input type="radio" class="btn-check" name="formToggle" id="formEdit" autocomplete="off">
                                <label class="btn btn-outline-warning btn-lg w-50" for="formEdit">
                                    <i class="bi bi-pencil-square me-2"></i>Edit Photo
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- Forms Container -->
                    <div class="forms-container">
                        <div id="addFormContainer">
                            <%- include("partials/fotos_formulario_add") -%>
                        </div>
                        <div id="editFormContainer" style="display: none;">
                            <%- include("partials/fotos_formulario_edit") -%>
                        </div>
                    </div>
                </div>

                <!-- Right Column: Photo List -->
                <div class="col-lg-6">
                    <%- include("partials/fotos_formulario_get", {fotos:fotos}) -%>
                </div>
            </div>
        </div>
        </main>
        <%- include("partials/footer") -%>

        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4" crossorigin="anonymous"></script>
        <script src="https://cdn.jsdelivr.net/npm/feather-icons@4.28.0/dist/feather.min.js" integrity="sha384-uO3SXW5IuS1ZpFPKugNNWqTZRRglnUJK6UAZ/gxOX80nxEkN9NcGZTftn6RzhGWE" crossorigin="anonymous"></script>
        <script src="https://cdn.jsdelivr.net/npm/chart.js@2.9.4/dist/Chart.min.js" integrity="sha384-zNy6FEbO50N+Cg5wap8IKA4M/ZnLJgzc6w2NqACZaK0u0FXfOWRRJOnQtpZun8ha" crossorigin="anonymous"></script>
        <script src="/javascripts/dashboard.js"></script>
        <script>
            document.addEventListener('DOMContentLoaded', function() {
                const formAdd = document.getElementById('formAdd');
                const formEdit = document.getElementById('formEdit');
                const addFormContainer = document.getElementById('addFormContainer');
                const editFormContainer = document.getElementById('editFormContainer');

                formAdd.addEventListener('change', function() {
                    if (this.checked) {
                        addFormContainer.style.display = 'block';
                        editFormContainer.style.display = 'none';
                    }
                });

                formEdit.addEventListener('change', function() {
                    if (this.checked) {
                        addFormContainer.style.display = 'none';
                        editFormContainer.style.display = 'block';
                    }
                });

                const idInput = document.getElementById('id');
                if (idInput) {
                    let debounceTimer;
                    
                    idInput.addEventListener('input', function() {
                        const photoId = this.value.trim();
                        
                        clearTimeout(debounceTimer);
                        
                        document.getElementById('photoNotFound').style.display = 'none';
                        document.getElementById('photoFound').style.display = 'none';
                        
                        if (photoId === '') {
                            clearEditForm();
                            return;
                        }
                        
                        debounceTimer = setTimeout(function() {
                            fetchPhotoById(photoId);
                        }, 500);
                    });
                }

                function fetchPhotoById(id) {
                    const loadingSpinner = document.getElementById('loadingSpinner');
                    const photoNotFound = document.getElementById('photoNotFound');
                    const photoFound = document.getElementById('photoFound');
                    
                    loadingSpinner.style.display = 'block';
                    
                    fetch(`/api/photos/${id}`)
                        .then(response => {
                            loadingSpinner.style.display = 'none';
                            
                            if (!response.ok) {
                                throw new Error('Photo not found');
                            }
                            return response.json();
                        })
                        .then(data => {
                            let photo = null;
                            
                            if (Array.isArray(data)) {
                                if (data.length > 0 && data[0] && data[0].id) {
                                    photo = data[0];
                                } else {
                                    throw new Error('Photo not found');
                                }
                            } else if (data && data.id) {
                                photo = data;
                            } else {
                                throw new Error('Photo not found');
                            }
                            
                            if (photo) {
                                document.getElementById('titulo_edit').value = photo.titulo || '';
                                document.getElementById('descripcion_edit').value = photo.descripcion || '';
                                document.getElementById('calificacion_edit').value = photo.calificacion || '';
                                
                                photoFound.style.display = 'block';
                                photoNotFound.style.display = 'none';
                                
                                setTimeout(function() {
                                    photoFound.style.display = 'none';
                                }, 3000);
                            } else {
                                throw new Error('Photo not found');
                            }
                        })
                        .catch(error => {
                            loadingSpinner.style.display = 'none';
                            photoNotFound.style.display = 'block';
                            photoFound.style.display = 'none';
                            
                            clearEditForm();
                        });
                }

                function clearEditForm() {
                    document.getElementById('titulo_edit').value = '';
                    document.getElementById('descripcion_edit').value = '';
                    document.getElementById('calificacion_edit').value = '';
                    document.getElementById('ruta_edit').value = '';
                }
            });
        </script>
    </body>
</html>